<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Running python tests on Travis's OSX workers | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="../../pl/rss.xml">
<link rel="canonical" href="https://fizyk.dev/blog/running-python-tests-on-traviss-osx-workers/">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
</head>
<body class="home blog">
    <div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Running python tests on Travis's OSX workers</a></h1>

        <div class="meta" style="background-color: rgb(234, 234, 234); ">
        <span class="authordate">
            Posted: <time class="published" datetime="2016-03-20T21:44:55+01:00">20 3 2016 21:44</time>
               [<a href="index.rst" id="sourcelink">Source</a>]
        </span>
        <br><span class="tags">Tags: 
                    <a class="tag" href="../../tags/osx/"><span>osx</span></a>
                    <a class="tag" href="../../tags/python/"><span>python</span></a>
                    <a class="tag" href="../../tags/tests/"><span>tests</span></a>
                    <a class="tag" href="../../tags/travis/"><span>travis</span></a>
                </span>
                <br><span class="authordate">
            

        </span>
        </div>
    <p>I, and my colleages are running tests mostly on linux, since our packages usually are clean python implementation.
However, for <a class="reference external" href="https://pypi.python.org/pypi/mirakuru/">mirakuru</a>, which we use to govern processes in tests,
and by extension <a class="reference external" href="https://pypi.python.org/pypi/pytest-dbfixtures/">pytest-dbfixtures</a>,
which has predefined process fixtures for pytest, we wanted to run tests also on osx. Travis.ci for
a long time had option to configure osx workers and linux, however python builds on osx are kind of broken by default.</p>
<p>Travis.ci has a long standing <a class="reference external" href="https://github.com/travis-ci/travis-ci/issues/2312">bug report</a> for this issue,
which will get 2 years old in this May. Apparently, just setting python as a language and osx among
the system to test on won't work for apple's operating system.</p>
<!-- TEASER_END -->
<p>Looking at the build log:</p>
<div class="code"><pre class="code text"><a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-1" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-1" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-1"></a>Build language: python
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-2" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-2" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-2"></a>Build group: stable
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-3" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-3" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-3"></a>Build dist: precise
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-4" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-4" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-4"></a>2.7 is not installed; attempting download
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-5" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-5" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-5"></a>/Users/travis/build.sh: line 235: lsb_release: command not found
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-6" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-6" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-6"></a>/Users/travis/build.sh: line 235: lsb_release: command not found
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-7" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-7" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-7"></a>tar: Unrecognized archive format
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-8" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-8" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-8"></a>tar: Error exit delayed from previous errors.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-9" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-9" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-9"></a>sed: /etc/profile.d/pyenv.sh: No such file or directory
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-10" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-10" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-10"></a>tee: /etc/profile.d/pyenv.sh: No such file or directory
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-11" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-11" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-11"></a>git.checkout
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-12" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-12" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-12"></a>3.00s$ git clone --depth=50 --branch=master https://github.com/ClearcodeHQ/mirakuru.git ClearcodeHQ/mirakuru
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-13" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-13" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-13"></a>Cloning into 'ClearcodeHQ/mirakuru'...
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-14" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-14" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-14"></a>remote: Counting objects: 441, done.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-15" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-15" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-15"></a>remote: Compressing objects: 100% (217/217), done.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-16" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-16" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-16"></a>Receiving objremote: Total 441 (delta 272), reused 374 (delta 214), pack-reused 0
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-17" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-17" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-17"></a>Receiving objects: 100% (441/441), 110.51 KiB | 0 bytes/s, done.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-18" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-18" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-18"></a>Resolving deltas: 100% (272/272), done.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-19" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-19" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-19"></a>Checking connectivity... done.
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-20" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-20" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-20"></a>$ cd ClearcodeHQ/mirakuru
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-21" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-21" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-21"></a>$ git checkout -qf e30530ac1419cdfb0ff047651c54e5ed9e918024
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-22" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-22" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-22"></a>0.00s$ source ~/virtualenv/python2.7/bin/activate
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-23" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-23" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-23"></a>/Users/travis/build.sh: line 45: /Users/travis/virtualenv/python2.7/bin/activate: No such file or directory
<a id="rest_code_b0a78b33418c415b9c00af52f7a733e6-24" name="rest_code_b0a78b33418c415b9c00af52f7a733e6-24" href="#rest_code_b0a78b33418c415b9c00af52f7a733e6-24"></a>The command "source ~/virtualenv/python2.7/bin/activate" failed and exited with 1 during .
</pre></div>
<p>It seems that the travis tries to work as if it was an ubuntu based worker, which fails the whole build in just few seconds.</p>
<p>Luckily, in said bug report,
<a class="reference external" href="https://github.com/travis-ci/travis-ci/issues/2312#issuecomment-195620855">a githubber Kodie Goodwin, shared his workaround for running tests within osx environment</a>.
It's basicaly requires building own python environment before proceeding to installation, and running the build as generic:</p>
<div class="code"><pre class="code yaml"><a id="rest_code_1d9196a4a8c840089be18c6465371158-1" name="rest_code_1d9196a4a8c840089be18c6465371158-1" href="#rest_code_1d9196a4a8c840089be18c6465371158-1"></a><span class="nt">matrix</span><span class="p">:</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-2" name="rest_code_1d9196a4a8c840089be18c6465371158-2" href="#rest_code_1d9196a4a8c840089be18c6465371158-2"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-3" name="rest_code_1d9196a4a8c840089be18c6465371158-3" href="#rest_code_1d9196a4a8c840089be18c6465371158-3"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">osx</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-4" name="rest_code_1d9196a4a8c840089be18c6465371158-4" href="#rest_code_1d9196a4a8c840089be18c6465371158-4"></a><span class="w">          </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-5" name="rest_code_1d9196a4a8c840089be18c6465371158-5" href="#rest_code_1d9196a4a8c840089be18c6465371158-5"></a><span class="c1"># Perform the manual steps on osx to install python3 and activate venv</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-6" name="rest_code_1d9196a4a8c840089be18c6465371158-6" href="#rest_code_1d9196a4a8c840089be18c6465371158-6"></a><span class="nt">before_install</span><span class="p">:</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-7" name="rest_code_1d9196a4a8c840089be18c6465371158-7" href="#rest_code_1d9196a4a8c840089be18c6465371158-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update          ; fi</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-8" name="rest_code_1d9196a4a8c840089be18c6465371158-8" href="#rest_code_1d9196a4a8c840089be18c6465371158-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install python3; fi</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-9" name="rest_code_1d9196a4a8c840089be18c6465371158-9" href="#rest_code_1d9196a4a8c840089be18c6465371158-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then virtualenv venv -p python3; fi</span>
<a id="rest_code_1d9196a4a8c840089be18c6465371158-10" name="rest_code_1d9196a4a8c840089be18c6465371158-10" href="#rest_code_1d9196a4a8c840089be18c6465371158-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source venv/bin/activate; fi</span>
</pre></div>
<p>Same fragment is used in mirakuru. We're running only one build on osx now, since well...
the only difference should be in the underlying system, and the all supported python versions are already tested on linux.</p>
<p>Speaking of which, we have four tests failing on osx, but at least the builds are running, and now we can try to figure out what's wrong.</p>
    
        <ul class="pager hidden-print">
<li class="previous">
                <a href="../creating-a-timestamp-in-python-difference-between-calendartimegm-and-timemktime/" rel="prev" title="Creating a timestamp in python - difference between calendar.timegm and time.mktime">Previous post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="https://fizyk.dev/blog/running-python-tests-on-traviss-osx-workers/",
        disqus_title="Running python tests on Travis's OSX workers",
        disqus_identifier="cache/posts/2016-03-20-running-python-tests-on-traviss-osx-workers.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </div>

        </div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="https://fizyk.dev/" title="Cases">Cases</a>
            </h1>
            
            <small>
                Also available in: 
                
            <li><a href="https://fizyk.dev/pl/" rel="alternate" hreflang="pl">Polski</a></li>

            </small>
            
            <ul class="unstyled">
<li>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    <img alt="Licencja Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a>
<br>Ten utwór, autorstwa
<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
    Grzegorz Śliwiński</span>
jest dostępny na licencji
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    Creative Commons Uznanie autorstwa 3.0 Unported
</a>.</li>
            
                <li>
<a href="https://fizyk.dev/">Homepage</a>
                </li>
<li>
<a href="../../archive/">Archives</a>
                </li>
<li>
<a href="../../tags/">Tags</a>

            </li>
<li>
            
            
            </ul>
</div>
        <div id="footer">
            Contents © 2025 <a href="mailto:fizyk~~fizyk.dev">Grzegorz Śliwiński</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
        </div>
    </div>
    
            <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
