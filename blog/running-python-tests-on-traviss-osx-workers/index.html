<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Running python tests on Travis's OSX workers | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" hreflang="pl" href="../../pl/rss.xml">
<link rel="canonical" href="http://blog.fizyk.net.pl/blog/running-python-tests-on-traviss-osx-workers/">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Grzegorz Śliwiński">
<link rel="prev" href="../creating-a-timestamp-in-python-difference-between-calendartimegm-and-timemktime/" title="Creating a timestamp in python - difference between calendar.timegm and time.mktime" type="text/html">
<meta property="og:site_name" content="Cases">
<meta property="og:title" content="Running python tests on Travis's OSX workers">
<meta property="og:url" content="http://blog.fizyk.net.pl/blog/running-python-tests-on-traviss-osx-workers/">
<meta property="og:description" content="I, and my colleages are running tests mostly on linux, since our packages usually are clean python implementation.
However, for mirakuru, which we use to govern processes in tests,
and by extension py">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-03-20T21:44:55+01:00">
<meta property="article:tag" content="osx">
<meta property="article:tag" content="python">
<meta property="article:tag" content="tests">
<meta property="article:tag" content="travis">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">Cases</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item"><a href="../../pl/" rel="alternate" hreflang="pl" class="nav-link">Polski</a></li>

                    
                    
    
    <li class="nav-item">
    <a href="index.rst" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="http://www.fizyk.net.pl/en" class="nav-link">Homepage</a>
                </li>
<li class="nav-item">
<a href="../../archive/" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../tags/" class="nav-link">Tags</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Running python tests on Travis's OSX workers</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Grzegorz Śliwiński
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2016-03-20T21:44:55+01:00" itemprop="datePublished" title="20 3 2016 21:44">20 3 2016 21:44</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2016-03-20-running-python-tests-on-traviss-osx-workers.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I, and my colleages are running tests mostly on linux, since our packages usually are clean python implementation.
However, for <a class="reference external" href="https://pypi.python.org/pypi/mirakuru/">mirakuru</a>, which we use to govern processes in tests,
and by extension <a class="reference external" href="https://pypi.python.org/pypi/pytest-dbfixtures/">pytest-dbfixtures</a>,
which has predefined process fixtures for pytest, we wanted to run tests also on osx. Travis.ci for
a long time had option to configure osx workers and linux, however python builds on osx are kind of broken by default.</p>
<p>Travis.ci has a long standing <a class="reference external" href="https://github.com/travis-ci/travis-ci/issues/2312">bug report</a> for this issue,
which will get 2 years old in this May. Apparently, just setting python as a language and osx among
the system to test on won't work for apple's operating system.</p>
<!-- TEASER_END -->
<p>Looking at the build log:</p>
<pre class="code text"><a id="rest_code_51253cb08504463286a0332821df4034-1" name="rest_code_51253cb08504463286a0332821df4034-1"></a>Build language: python
<a id="rest_code_51253cb08504463286a0332821df4034-2" name="rest_code_51253cb08504463286a0332821df4034-2"></a>Build group: stable
<a id="rest_code_51253cb08504463286a0332821df4034-3" name="rest_code_51253cb08504463286a0332821df4034-3"></a>Build dist: precise
<a id="rest_code_51253cb08504463286a0332821df4034-4" name="rest_code_51253cb08504463286a0332821df4034-4"></a>2.7 is not installed; attempting download
<a id="rest_code_51253cb08504463286a0332821df4034-5" name="rest_code_51253cb08504463286a0332821df4034-5"></a>/Users/travis/build.sh: line 235: lsb_release: command not found
<a id="rest_code_51253cb08504463286a0332821df4034-6" name="rest_code_51253cb08504463286a0332821df4034-6"></a>/Users/travis/build.sh: line 235: lsb_release: command not found
<a id="rest_code_51253cb08504463286a0332821df4034-7" name="rest_code_51253cb08504463286a0332821df4034-7"></a>tar: Unrecognized archive format
<a id="rest_code_51253cb08504463286a0332821df4034-8" name="rest_code_51253cb08504463286a0332821df4034-8"></a>tar: Error exit delayed from previous errors.
<a id="rest_code_51253cb08504463286a0332821df4034-9" name="rest_code_51253cb08504463286a0332821df4034-9"></a>sed: /etc/profile.d/pyenv.sh: No such file or directory
<a id="rest_code_51253cb08504463286a0332821df4034-10" name="rest_code_51253cb08504463286a0332821df4034-10"></a>tee: /etc/profile.d/pyenv.sh: No such file or directory
<a id="rest_code_51253cb08504463286a0332821df4034-11" name="rest_code_51253cb08504463286a0332821df4034-11"></a>git.checkout
<a id="rest_code_51253cb08504463286a0332821df4034-12" name="rest_code_51253cb08504463286a0332821df4034-12"></a>3.00s$ git clone --depth=50 --branch=master https://github.com/ClearcodeHQ/mirakuru.git ClearcodeHQ/mirakuru
<a id="rest_code_51253cb08504463286a0332821df4034-13" name="rest_code_51253cb08504463286a0332821df4034-13"></a>Cloning into 'ClearcodeHQ/mirakuru'...
<a id="rest_code_51253cb08504463286a0332821df4034-14" name="rest_code_51253cb08504463286a0332821df4034-14"></a>remote: Counting objects: 441, done.
<a id="rest_code_51253cb08504463286a0332821df4034-15" name="rest_code_51253cb08504463286a0332821df4034-15"></a>remote: Compressing objects: 100% (217/217), done.
<a id="rest_code_51253cb08504463286a0332821df4034-16" name="rest_code_51253cb08504463286a0332821df4034-16"></a>Receiving objremote: Total 441 (delta 272), reused 374 (delta 214), pack-reused 0
<a id="rest_code_51253cb08504463286a0332821df4034-17" name="rest_code_51253cb08504463286a0332821df4034-17"></a>Receiving objects: 100% (441/441), 110.51 KiB | 0 bytes/s, done.
<a id="rest_code_51253cb08504463286a0332821df4034-18" name="rest_code_51253cb08504463286a0332821df4034-18"></a>Resolving deltas: 100% (272/272), done.
<a id="rest_code_51253cb08504463286a0332821df4034-19" name="rest_code_51253cb08504463286a0332821df4034-19"></a>Checking connectivity... done.
<a id="rest_code_51253cb08504463286a0332821df4034-20" name="rest_code_51253cb08504463286a0332821df4034-20"></a>$ cd ClearcodeHQ/mirakuru
<a id="rest_code_51253cb08504463286a0332821df4034-21" name="rest_code_51253cb08504463286a0332821df4034-21"></a>$ git checkout -qf e30530ac1419cdfb0ff047651c54e5ed9e918024
<a id="rest_code_51253cb08504463286a0332821df4034-22" name="rest_code_51253cb08504463286a0332821df4034-22"></a>0.00s$ source ~/virtualenv/python2.7/bin/activate
<a id="rest_code_51253cb08504463286a0332821df4034-23" name="rest_code_51253cb08504463286a0332821df4034-23"></a>/Users/travis/build.sh: line 45: /Users/travis/virtualenv/python2.7/bin/activate: No such file or directory
<a id="rest_code_51253cb08504463286a0332821df4034-24" name="rest_code_51253cb08504463286a0332821df4034-24"></a>The command "source ~/virtualenv/python2.7/bin/activate" failed and exited with 1 during .
</pre>
<p>It seems that the travis tries to work as if it was an ubuntu based worker, which fails the whole build in just few seconds.</p>
<p>Luckily, in said bug report,
<a class="reference external" href="https://github.com/travis-ci/travis-ci/issues/2312#issuecomment-195620855">a githubber Kodie Goodwin, shared his workaround for running tests within osx environment</a>.
It's basicaly requires building own python environment before proceeding to installation, and running the build as generic:</p>
<pre class="code yaml"><a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-1" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-1"></a><span class="nt">matrix</span><span class="p">:</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-2" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-2"></a>    <span class="nt">include</span><span class="p">:</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-3" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-3"></a>        <span class="p p-Indicator">-</span> <span class="nt">os</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osx</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-4" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-4"></a>          <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">generic</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-5" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-5"></a><span class="c1"># Perform the manual steps on osx to install python3 and activate venv</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-6" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-6"></a><span class="nt">before_install</span><span class="p">:</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-7" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-7"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update          ; fi</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-8" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-8"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install python3; fi</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-9" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-9"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then virtualenv venv -p python3; fi</span>
<a id="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-10" name="rest_code_2fa3ce1082e94f14bf0296c5b5d3d516-10"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source venv/bin/activate; fi</span>
</pre>
<p>Same fragment is used in mirakuru. We're running only one build on osx now, since well...
the only difference should be in the underlying system, and the all supported python versions are already tested on linux.</p>
<p>Speaking of which, we have four tests failing on osx, but at least the builds are running, and now we can try to figure out what's wrong.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/osx/" rel="tag">osx</a></li>
            <li><a class="tag p-category" href="../../tags/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../tags/tests/" rel="tag">tests</a></li>
            <li><a class="tag p-category" href="../../tags/travis/" rel="tag">travis</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../creating-a-timestamp-in-python-difference-between-calendartimegm-and-timemktime/" rel="prev" title="Creating a timestamp in python - difference between calendar.timegm and time.mktime">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="http://blog.fizyk.net.pl/blog/running-python-tests-on-traviss-osx-workers/",
        disqus_title="Running python tests on Travis's OSX workers",
        disqus_identifier="cache/posts/2016-03-20-running-python-tests-on-traviss-osx-workers.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="casesblog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2021 <a href="mailto:fizyk~~fizyk.net.pl">Grzegorz Śliwiński</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
