<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some time ago, I decided to check, how sqlalchemy will cope with different mysql drivers in terms of efficiency. At Red Sky, we used MySQLdb for all python projects, at least within our team. But MySQLdb requires mysql-client library, and does some compiling during installation.">
<meta name="viewport" content="width=device-width">
<title>sqlAlchemy speed tests on mysql-connector-python, mysqldb and oursql drivers | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="../../pl/rss.xml">
<link rel="canonical" href="http://blog.fizyk.net.pl/blog/sqlalchemy-speed-tests-on-mysql-connector-python-mysqldb-and-oursql-drivers/">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
</head>
<body class="home blog">
    <div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">sqlAlchemy speed tests on mysql-connector-python, mysqldb and oursql drivers</a></h1>

        <div class="meta" style="background-color: rgb(234, 234, 234); ">
        <span class="authordate">
            Posted: <time class="published" datetime="2012-10-18T23:10:15+02:00">18 10 2012 23:10</time>
               [<a href="index.rst" id="sourcelink">Source</a>]
        </span>
        <br><span class="tags">Tags:Â 
                    <a class="tag" href="../../tags/mysql/"><span>mysql</span></a>
                    <a class="tag" href="../../tags/python/"><span>python</span></a>
                    <a class="tag" href="../../tags/sqlalchemy/"><span>sqlalchemy</span></a>
                </span>
                <br><span class="authordate">
            

        </span>
        </div>
    <div>
<p>Some time ago, I decided to check, how sqlalchemy will cope with
different mysql drivers in terms of efficiency. At Red Sky, we used
<a class="reference external" href="http://pypi.python.org/pypi/MySQL-python/1.2.4b5">MySQLdb</a> for all
python projects, at least within our team. But MySQLdb requires
mysql-client library, and does some compiling during installation.</p>
<!-- TEASER_END -->
<p>I was wondering how other drivers will perform, and then saw <a class="reference external" href="http://geert.vanderkelen.org/mysql-connector-python-1-0-5-beta/">Geert
Vanderkelen's</a>
post about
<a class="reference external" href="http://pypi.python.org/pypi/mysql-connector-python">mysql-connector</a>,
which he is apparently developing at Oracle, so I decided to write a
little test, and see how it will present itself compared to compiled
MySQLdb. I've chosen also <a class="reference external" href="http://pypi.python.org/pypi/oursql">oursql</a>
as a third driver in this comparison.</p>
<p>Overall there were 5 different tests performed, each in three runs for
100 operations for 1, 10 and 100 objects per operation.</p>
<p>The five tests were:</p>
<ul class="simple">
<li><p>Insert with rollback</p></li>
<li><p>Insert with commit</p></li>
<li><p>Select</p></li>
<li><p>Delete with rollback</p></li>
<li><p>Delete with commit</p></li>
</ul>
<p>Test tools used here are:</p>
<ul class="simple">
<li><p>python (CPython) 2.7.3 (on Ubuntu 12.04)</p></li>
<li><p>mysql 5.1.61 (hosted on megiteam.pl servers)</p></li>
<li><p>sqlalchemy 0.7.9</p></li>
<li><p>oursql 0.9.3.1</p></li>
<li><p>mysql-connector-python 1.0.6b2</p></li>
<li><p>mysqldb 1.2.3 and 1.2.4b5</p></li>
</ul>
<p>Result were all in favour of <strong>MySQLdb</strong>, what was to be expected, since
it uses some C modules compiled against mysql-client library (you
actually need mysql-client-dev if you're installing it on virtualenv).
But let me present those results:</p>
<section id="test-results"><h2>Test results</h2>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 22%">
<col style="width: 24%">
</colgroup>
<thead><tr>
<th class="head"></th>
<th class="head"><p>s/run 1</p></th>
<th class="head"><p>s/run 10</p></th>
<th class="head"><p>s/run 100</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>MySQLdb 1.2.3</p></td>
<td><p>0.083</p></td>
<td><p>0.352</p></td>
<td><p>3.097</p></td>
</tr>
<tr>
<td><p>MySQLdb 1.2.4b5</p></td>
<td><p>0.096</p></td>
<td><p>0.331</p></td>
<td><p>2.825</p></td>
</tr>
<tr>
<td><p>Connector</p></td>
<td><p>0.107</p></td>
<td><p>0.621</p></td>
<td><p>4.956</p></td>
</tr>
<tr>
<td><p>Oursql</p></td>
<td><p>0.131</p></td>
<td><p>0.651</p></td>
<td><p>5.790</p></td>
</tr>
</tbody>
</table>
<p>Table:  Insert with rollback</p>
<p>As expected, mysqdb is performing much better, with older version being
better at one object operations and newer slightly better on multiobject
operations. Connector not much slower on one object operations, but
twice slower like oursql on multiobject operations</p>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 22%">
<col style="width: 24%">
</colgroup>
<thead><tr>
<th class="head"></th>
<th class="head"><p>s/run 1</p></th>
<th class="head"><p>s/run 10</p></th>
<th class="head"><p>s/run 100</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>MySQLdb 1.2.3</p></td>
<td><p>0.082</p></td>
<td><p>0.368</p></td>
<td><p>3.402</p></td>
</tr>
<tr>
<td><p>MySQLdb 1.2.4b5</p></td>
<td><p>0.074</p></td>
<td><p>0.374</p></td>
<td><p>3.128</p></td>
</tr>
<tr>
<td><p>Connector</p></td>
<td><p>0.129</p></td>
<td><p>0.596</p></td>
<td><p>5.539</p></td>
</tr>
<tr>
<td><p>Oursql</p></td>
<td><p>0.130</p></td>
<td><p>0.647</p></td>
<td><p>5.638</p></td>
</tr>
</tbody>
</table>
<p>Table:  Insert with commit</p>
<p>With commiting inserts, Connector is only slightly better than oursql,
with mysqldb much faster in all cases.</p>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 22%">
<col style="width: 24%">
</colgroup>
<thead><tr>
<th class="head"></th>
<th class="head"><p>s/run 1</p></th>
<th class="head"><p>s/run 10</p></th>
<th class="head"><p>s/run 100</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>MySQLdb 1.2.3</p></td>
<td><p>0.031</p></td>
<td><p>0.039</p></td>
<td><p>0.199</p></td>
</tr>
<tr>
<td><p>MySQLdb 1.2.4b5</p></td>
<td><p>0.033</p></td>
<td><p>0.040</p></td>
<td><p>0.142</p></td>
</tr>
<tr>
<td><p>Connector</p></td>
<td><p>0.056</p></td>
<td><p>0.067</p></td>
<td><p>Error</p></td>
</tr>
<tr>
<td><p>Oursql</p></td>
<td><p>0.078</p></td>
<td><p>0.109</p></td>
<td><p>0.235</p></td>
</tr>
</tbody>
</table>
<p>Table:  Select</p>
<p>With simple select both mysqldb versions were much better, but connector
in the middle road between mysqldb and oursql. With surprise error on
SELECT 100 test... Every time I tried to run it, MySQL server would go
away "<em>sqlalchemy.exc.InterfaceError: (InterfaceError) 2013: Lost
connection to MySQL server during query u'SELECT(...)</em>" And that's
just this test.</p>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 22%">
<col style="width: 24%">
</colgroup>
<thead><tr>
<th class="head"></th>
<th class="head"><p>s/run 1</p></th>
<th class="head"><p>s/run 10</p></th>
<th class="head"><p>s/run 100</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>MySQLdb 1.2.3</p></td>
<td><p>0.074</p></td>
<td><p>0.079</p></td>
<td><p>0.120</p></td>
</tr>
<tr>
<td><p>MySQLdb 1.2.4b5</p></td>
<td><p>0.074</p></td>
<td><p>0.101</p></td>
<td><p>0.088</p></td>
</tr>
<tr>
<td><p>Connector</p></td>
<td><p>0.103</p></td>
<td><p>0.103</p></td>
<td><p>0.120</p></td>
</tr>
<tr>
<td><p>Oursql</p></td>
<td><p>0.103</p></td>
<td><p>0.146</p></td>
<td><p>0.278</p></td>
</tr>
</tbody>
</table>
<p>Table:  Delete with rollback</p>
<p>Rollback delete finally brings connector close to mysqldb performance.
And oursql still performs worse, with except deleting one item, where it
has identical performance to connector. Strangely, if you're going to
probably delete (but possibly roll it back) lots of object, your choice
would be newer version od MySQLdb, but if you have less quantities,
older would save you some fractal of a seconds.</p>
<table>
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 22%">
<col style="width: 24%">
</colgroup>
<thead><tr>
<th class="head"></th>
<th class="head"><p>s/run 1</p></th>
<th class="head"><p>s/run 10</p></th>
<th class="head"><p>s/run 100</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>MySQLdb 1.2.3</p></td>
<td><p>0.078</p></td>
<td><p>0.078</p></td>
<td><p>0.117</p></td>
</tr>
<tr>
<td><p>MySQLdb 1.2.4b5</p></td>
<td><p>0.072</p></td>
<td><p>0.071</p></td>
<td><p>0.097</p></td>
</tr>
<tr>
<td><p>Connector</p></td>
<td><p>0.112</p></td>
<td><p>0.106</p></td>
<td><p>0.134</p></td>
</tr>
<tr>
<td><p>Oursql</p></td>
<td><p>0.111</p></td>
<td><p>0.132</p></td>
<td><p>0.203</p></td>
</tr>
</tbody>
</table>
<p>Table:  Delete with commit</p>
<p>Commiting makes connector performance worse, but it's still much better
than oursql. MySQLdb newer version is choice here.</p>
<p>I must admit, I was silently hoping that connector will perform better,
comparable to MySQLdb. It's still good, but delete opeartions are
usually less possible, than inserts, where MySQLdb fully shines. And
error found on select test is not helping either. Oursql... is what I
expected after first tries.</p>
<p>If you'd like to test by yourself, here's the code (yep, it's been
created almost two months ago):</p>
<pre class="code python"><a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-1" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-1"></a><span class="c1"># -*- coding: utf-8 -*</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-2" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-2"></a><span class="sd">'''</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-3" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-3"></a><span class="sd">Created on 12-08-2012</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-4" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-4"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-5" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-5"></a><span class="sd">@author: fizyk</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-6" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-6"></a><span class="sd">'''</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-7" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-7"></a><span class="kn">import</span> <span class="nn">sys</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-8" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-8"></a><span class="kn">import</span> <span class="nn">timeit</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-9" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-9"></a><span class="kn">import</span> <span class="nn">types</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-10" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-10"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-11" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-11"></a><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-12" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-12"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-13" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-13"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-14" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-14"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Unicode</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-15" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-15"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">UnicodeText</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-16" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-16"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-17" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-17"></a><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-18" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-18"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-19" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-19"></a><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-20" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-20"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-21" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-21"></a><span class="c1"># 238 characters length</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-22" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-22"></a><span class="n">title</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">'Here, the Object Relational Mapper is introduced and fully described. If you want to work with higher-level SQL which is constructed automatically for you, as well as automated persistence of Python objects, proceed first to the tutorial.</span><span class="si">{0}</span><span class="s1">'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-23" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-23"></a><span class="c1">#1912 characters length</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-24" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-24"></a><span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">'''</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-25" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-25"></a><span class="s1">The SQLAlchemy Object Relational Mapper presents a method of associating user-defined Python classes with database tables, and instances of those classes (objects) with rows in their corresponding tables. It includes a system that transparently synchronizes all changes in state between objects and their related rows, called a unit of work, as well as a system for expressing database queries in terms of the user defined classes and their defined relationships between each other.</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-26" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-26"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-27" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-27"></a><span class="s1">The ORM is in contrast to the SQLAlchemy Expression Language, upon which the ORM is constructed. Whereas the SQL Expression Language, introduced in SQL Expression Language Tutorial, presents a system of representing the primitive constructs of the relational database directly without opinion, the ORM presents a high level and abstracted pattern of usage, which itself is an example of applied usage of the Expression Language.</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-28" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-28"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-29" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-29"></a><span class="s1">While there is overlap among the usage patterns of the ORM and the Expression Language, the similarities are more superficial than they may at first appear. One approaches the structure and content of data from the perspective of a user-defined domain model which is transparently persisted and refreshed from its underlying storage model. The other approaches it from the perspective of literal schema and SQL expression representations which are explicitly composed into messages consumed individually by the database.</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-30" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-30"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-31" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-31"></a><span class="s1">A successful application may be constructed using the Object Relational Mapper exclusively. In advanced situations, an application constructed with the ORM may make occasional usage of the Expression Language directly in certain areas where specific database interactions are required.</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-32" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-32"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-33" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-33"></a><span class="s1">The following tutorial is in doctest format, meaning each &gt;&gt;&gt; line represents something you can type at a Python command prompt, and the following text represents the expected return value.</span><span class="si">{0}</span><span class="s1"></span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-34" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-34"></a><span class="s1">'''</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-35" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-35"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-36" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-36"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-37" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-37"></a><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-38" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-38"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-39" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-39"></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">'test_table'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-40" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-40"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-41" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-41"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-42" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-42"></a>    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-43" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-43"></a>    <span class="n">text</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-44" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-44"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-45" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-45"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-46" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-46"></a><span class="n">dialect</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-47" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-47"></a><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'</span><span class="si">{0}</span><span class="s1">://my_8685a:testtest@fizyk.megiteam.pl:3307/my_8685'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dialect</span><span class="p">))</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-48" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-48"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-49" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-49"></a><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-50" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-50"></a><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-51" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-51"></a><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-52" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-52"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-53" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-53"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-54" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-54"></a><span class="k">def</span> <span class="nf">_create_test_objects</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-55" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-55"></a>    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-56" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-56"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-57" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-57"></a>        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Test</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-58" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-58"></a>                     <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-59" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-59"></a>    <span class="k">return</span> <span class="n">tests</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-60" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-60"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-61" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-61"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-62" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-62"></a><span class="k">def</span> <span class="nf">_read_ids</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-63" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-63"></a>    <span class="n">ids</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-64" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-64"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-65" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-65"></a>    <span class="k">return</span> <span class="p">[</span><span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-66" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-66"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-67" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-67"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-68" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-68"></a><span class="k">def</span> <span class="nf">sqltest_add_rollback</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tests</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-69" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-69"></a>    <span class="s1">'Insert rollback test'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-70" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-70"></a>    <span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-71" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-71"></a>    <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-72" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-72"></a>    <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-73" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-73"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-74" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-74"></a><span class="n">sqltest_add_rollback</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">=</span> <span class="s1">'list'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-75" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-75"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-76" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-76"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-77" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-77"></a><span class="k">def</span> <span class="nf">sqltest_add_commit</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tests</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-78" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-78"></a>    <span class="s1">'Insert commit test'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-79" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-79"></a>    <span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-80" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-80"></a>    <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-81" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-81"></a>    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-82" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-82"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-83" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-83"></a><span class="n">sqltest_add_commit</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">=</span> <span class="s1">'list'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-84" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-84"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-85" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-85"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-86" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-86"></a><span class="k">def</span> <span class="nf">sqltest_select</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-87" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-87"></a>    <span class="s1">'Select test'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-88" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-88"></a>    <span class="n">elements</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Test</span><span class="p">)[:</span><span class="n">number</span><span class="p">]</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-89" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-89"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-90" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-90"></a><span class="n">sqltest_select</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">=</span> <span class="s1">'int'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-91" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-91"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-92" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-92"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-93" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-93"></a><span class="k">def</span> <span class="nf">sqltest_delete_rollback</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-94" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-94"></a>    <span class="s1">'Delete test rollback'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-95" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-95"></a>    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Test</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">synchronize_session</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-96" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-96"></a>    <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-97" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-97"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-98" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-98"></a><span class="n">sqltest_delete_rollback</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">=</span> <span class="s1">'del'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-99" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-99"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-100" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-100"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-101" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-101"></a><span class="k">def</span> <span class="nf">sqltest_delete_commit</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-102" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-102"></a>    <span class="s1">'Delete test commit'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-103" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-103"></a>    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Test</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">synchronize_session</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-104" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-104"></a>    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-105" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-105"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-106" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-106"></a><span class="n">sqltest_delete_commit</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">=</span> <span class="s1">'del'</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-107" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-107"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-108" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-108"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-109" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-109"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-110" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-110"></a>    <span class="n">test_repeat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-111" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-111"></a>    <span class="n">counters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-112" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-112"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-113" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-113"></a>    <span class="n">alchemy_tests</span> <span class="o">=</span> <span class="p">[</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-114" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-114"></a>        <span class="n">sqltest_add_rollback</span><span class="p">,</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-115" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-115"></a>        <span class="n">sqltest_add_commit</span><span class="p">,</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-116" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-116"></a>        <span class="n">sqltest_select</span><span class="p">,</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-117" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-117"></a>        <span class="n">sqltest_delete_rollback</span><span class="p">,</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-118" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-118"></a>        <span class="n">sqltest_delete_commit</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-119" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-119"></a>    <span class="p">]</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-120" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-120"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-121" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-121"></a>    <span class="nb">print</span> <span class="s1">'='</span> <span class="o">*</span> <span class="mi">20</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-122" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-122"></a>    <span class="nb">print</span> <span class="s1">'</span><span class="si">{dialect}</span><span class="s1"> dialect test'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">dialect</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-123" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-123"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-124" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-124"></a>    <span class="k">for</span> <span class="n">alchemy_test</span> <span class="ow">in</span> <span class="n">alchemy_tests</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-125" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-125"></a>        <span class="nb">print</span> <span class="s1">'-'</span> <span class="o">*</span> <span class="mi">20</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-126" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-126"></a>        <span class="nb">print</span> <span class="n">alchemy_test</span><span class="o">.</span><span class="vm">__doc__</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-127" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-127"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-128" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-128"></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">counters</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-129" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-129"></a>            <span class="nb">print</span> <span class="s1">'Objects: </span><span class="si">{0}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1"> tests)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">test_repeat</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-130" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-130"></a>            <span class="n">t_avg</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-131" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-131"></a>            <span class="n">t_max</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-132" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-132"></a>            <span class="n">t_min</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-133" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-133"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">test_repeat</span><span class="p">):</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-134" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-134"></a>                <span class="k">if</span> <span class="n">alchemy_test</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">==</span> <span class="s1">'list'</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-135" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-135"></a>                    <span class="n">tests</span> <span class="o">=</span> <span class="n">_create_test_objects</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-136" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-136"></a>                <span class="k">elif</span> <span class="n">alchemy_test</span><span class="o">.</span><span class="n">__arg__</span> <span class="o">==</span> <span class="s1">'del'</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-137" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-137"></a>                    <span class="n">tests</span> <span class="o">=</span> <span class="n">_read_ids</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-138" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-138"></a>                <span class="k">else</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-139" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-139"></a>                    <span class="n">tests</span> <span class="o">=</span> <span class="n">c</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-140" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-140"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-141" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-141"></a>                <span class="n">timer</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">alchemy_test</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tests</span><span class="p">))</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-142" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-142"></a>                <span class="k">try</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-143" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-143"></a>                    <span class="n">current</span> <span class="o">=</span> <span class="n">timer</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-144" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-144"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">t_min</span> <span class="ow">or</span> <span class="n">t_min</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-145" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-145"></a>                        <span class="n">t_min</span> <span class="o">=</span> <span class="n">current</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-146" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-146"></a>                    <span class="k">if</span> <span class="n">t_max</span> <span class="o">&lt;</span> <span class="n">current</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-147" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-147"></a>                        <span class="n">t_max</span> <span class="o">=</span> <span class="n">current</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-148" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-148"></a>                    <span class="n">t_avg</span> <span class="o">+=</span> <span class="n">current</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-149" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-149"></a>                <span class="k">except</span><span class="p">:</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-150" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-150"></a>                    <span class="n">timer</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-151" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-151"></a>                    <span class="k">raise</span>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-152" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-152"></a>
<a id="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-153" name="rest_code_f08d5f160e6140cb89a9ecaa0b6b23dd-153"></a>            <span class="nb">print</span> <span class="s2">"</span><span class="si">{0:.3f}</span><span class="s2"> s/run. t_min: </span><span class="si">{1:.3f}</span><span class="s2">, t_max: </span><span class="si">{2:.3f}</span><span class="s2">, object_average: </span><span class="si">{3:.3f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">t_avg</span> <span class="o">/</span> <span class="n">test_repeat</span><span class="p">),</span> <span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="p">(</span><span class="n">t_avg</span> <span class="o">/</span> <span class="p">(</span><span class="n">test_repeat</span> <span class="o">*</span> <span class="n">c</span><span class="p">)))</span>
</pre>
<p>If anyone would be interested in full time reults, I'll drop them on
gist (I have additionally minium time, maximum, and object average)</p>
</section>
</div>
    
        <ul class="pager hidden-print">
<li class="previous">
                <a href="../howto-list-module-s-methods-in-python/" rel="prev" title="Howto list module's methods in python">Previous post</a>
            </li>
            <li class="next">
                <a href="../welcome-nikola/" rel="next" title="Welcome, Nikola">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="http://blog.fizyk.net.pl/blog/sqlalchemy-speed-tests-on-mysql-connector-python-mysqldb-and-oursql-drivers/",
        disqus_title="sqlAlchemy speed tests on mysql-connector-python, mysqldb and oursql drivers",
        disqus_identifier="cache/posts/2012-10-18-sqlalchemy-speed-tests-on-mysql.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </div>

        </div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="http://blog.fizyk.net.pl/" title="Cases">Cases</a>
            </h1>
            
            <small>
                Also available in:Â 
                
            <li><a href="http://blog.fizyk.net.pl/pl/" rel="alternate" hreflang="pl">Polski</a></li>

            </small>
            
            <ul class="unstyled">
<li>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    <img alt="Licencja Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a>
<br>Ten utwÃ³r, autorstwa
<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
    Grzegorz ÅliwiÅski</span>
jest dostÄpny na licencji
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    Creative Commons Uznanie autorstwa 3.0 Unported
</a>.</li>
            
                <li>
<a href="http://www.fizyk.net.pl/en">Homepage</a>
                </li>
<li>
<a href="../../archive/">Archives</a>
                </li>
<li>
<a href="../../tags/">Tags</a>

            </li>
<li>
            
            
            </ul>
</div>
        <div id="footer">
            Contents Â© 2021 <a href="mailto:fizyk~~fizyk.net.pl">Grzegorz ÅliwiÅski</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
        </div>
    </div>
    
            <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
