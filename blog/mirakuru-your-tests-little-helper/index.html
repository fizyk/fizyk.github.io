<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="mirakuru 0.1.0 announcement.">
<meta name="viewport" content="width=device-width">
<title>mirakuru, your tests little helper | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="../../pl/rss.xml">
<link rel="canonical" href="http://blog.fizyk.net.pl/blog/mirakuru-your-tests-little-helper/">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
</head>
<body class="home blog">
    <div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">mirakuru, your tests little helper</a></h1>

        <div class="meta" style="background-color: rgb(234, 234, 234); ">
        <span class="authordate">
            Posted: <time class="published" datetime="2014-07-03T20:19:11+02:00">03 7 2014 20:19</time>
               [<a href="index.rst" id="sourcelink">Source</a>]
        </span>
        <br><span class="tags">Tags: 
                    <a class="tag" href="../../tags/mirakuru/"><span>mirakuru</span></a>
                    <a class="tag" href="../../tags/python/"><span>python</span></a>
                    <a class="tag" href="../../tags/testing/"><span>testing</span></a>
                </span>
                <br><span class="authordate">
            

        </span>
        </div>
    <div>
<p>Just yesterday, we released first version of mirakuru.
Mirakuru is a helpful tools that lets add superpowers to Your tests, or maybe
other scripts that need other processes to run.</p>
<p>With few lines of code, mirakuru guarantees, that when running, your script will
start it's own database instance, or the webserver you've just wrote, and need
to test it by sending real requests to it - automatically.</p>
<!-- TEASER_END -->
<p>mirakuru is a fork of a <a class="reference external" href="https://github.com/mlen/summon_process">summon_process</a>
library, we use a lot in both our tests, and <a class="reference external" href="https://github.com/ClearcodeHQ/pytest-dbfixtures">pytest-dbfixture</a> package, and it coded to work both in
python 2.7, 3.2, 3.3 and 3.4. We also simplified package structure, api,
striped some specialized context manager code and change packages's  that,
in our opinion better reflect it's character and dangers it brings.</p>
<section id="why-the-mirakuru-name-then"><h2>Why the <cite>mirakuru</cite> name then?</h2>
<p>If you've seen <a class="reference external" href="http://www.imdb.com/title/tt2193021/">Arrow</a> TV series,
you'll already know, if You haven't, mirakuru was a substance, a super-soldier
serum invented by Japanese scientists during World War II.
It gave injected person a super human abilities, speed, reflex, strength,
healing - (Something like Cpt. America from Marvel's Universe).
And just as <strong>mirakuru</strong> there, this package, will allow your tests to run
without You to care about database service being running on your test machine.</p>
<p>But <strong>mirakuru</strong> there had also a side effect, their user was rendered emotionally
unstable, unpredictable, and hallucinating. And same here, You've got to watch
on how many processes you start, and what they're doing.</p>
<p>It might also make writing integration tests much easier than unittest,
but as long as they work, you might forget that it's easier and faster to fix
some behaviour on unittest than on integration with several subprocesses.
Or make you focus on completely irrelevant part of your code.</p>
<p>By using <strong>mirakuru</strong>, all you need to provide for CI machine are database servers
executables. They'll be started along your test suite, and configured accordingly.</p>
</section><section id="how-does-it-work"><h2>How does it work?</h2>
<p>Without further babling, here's example from mirakuru's readme:</p>
<pre class="code python"><a id="rest_code_91568bcc5ee74dbaacbd02361d584784-1" name="rest_code_91568bcc5ee74dbaacbd02361d584784-1"></a><span class="kn">from</span> <span class="nn">mirakuru</span> <span class="kn">import</span> <span class="n">HTTPExecutor</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-2" name="rest_code_91568bcc5ee74dbaacbd02361d584784-2"></a><span class="kn">from</span> <span class="nn">httplib</span> <span class="kn">import</span> <span class="n">HTTPConnection</span><span class="p">,</span> <span class="n">OK</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-3" name="rest_code_91568bcc5ee74dbaacbd02361d584784-3"></a>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-4" name="rest_code_91568bcc5ee74dbaacbd02361d584784-4"></a>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-5" name="rest_code_91568bcc5ee74dbaacbd02361d584784-5"></a><span class="k">def</span> <span class="nf">test_it_works</span><span class="p">():</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-6" name="rest_code_91568bcc5ee74dbaacbd02361d584784-6"></a>    <span class="n">executor</span> <span class="o">=</span> <span class="n">HTTPExecutor</span><span class="p">(</span><span class="s2">"./server"</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">"http://localhost:6543/"</span><span class="p">)</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-7" name="rest_code_91568bcc5ee74dbaacbd02361d584784-7"></a>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-8" name="rest_code_91568bcc5ee74dbaacbd02361d584784-8"></a>    <span class="c1"># start and wait for it to run</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-9" name="rest_code_91568bcc5ee74dbaacbd02361d584784-9"></a>    <span class="n">executor</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-10" name="rest_code_91568bcc5ee74dbaacbd02361d584784-10"></a>    <span class="c1"># should be running!</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-11" name="rest_code_91568bcc5ee74dbaacbd02361d584784-11"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">HTTPConnection</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="mi">6543</span><span class="p">)</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-12" name="rest_code_91568bcc5ee74dbaacbd02361d584784-12"></a>    <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">)</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-13" name="rest_code_91568bcc5ee74dbaacbd02361d584784-13"></a>    <span class="k">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="n">OK</span>
<a id="rest_code_91568bcc5ee74dbaacbd02361d584784-14" name="rest_code_91568bcc5ee74dbaacbd02361d584784-14"></a>    <span class="n">executor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre>
<p>What we did here:</p>
<ol class="arabic simple">
<li><p>We told executor how to start our webapp, and what http address it'll be using to receive requests.</p></li>
<li><dl class="simple">
<dt>Then we start the executor.</dt>
<dd><ol class="arabic simple">
<li><p>Executor first started the process</p></li>
<li><p>Then, determined, if executor is accepting requests on hostname and port extracted from url.</p></li>
<li><p>Once the process accepts connections, executors tries to make a successful HEAD request on url.</p></li>
<li><p>And only after the HEAD request is successful, tests continue, and we can interact with running application underneath.</p></li>
</ol></dd>
</dl></li>
</ol>
<p>Timeout <cite>mirakuru</cite> uses, is configurable, so executor might wait 20 seconds,
2 minutes, or indefinitely. And same goes for stopping process.</p>
<p>Whenever Timeout is exceeded, both actions rises TimeoutException error.</p>
</section><section id="what-after-that"><h2>What after that?</h2>
<p>Apart from some minor enhancements, we're considering adding specialized executors
for databases, or queue systems.</p>
<p>It could also provide a command line utility that would be able to start
processes based on configuration, and tests written in other language
(or one that does not use mirakuru directly).</p>
</section><section id="links"><h2>Links:</h2>
<p>Links where mirakuru is accessible:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://pypi.python.org/pypi/mirakuru/0.1.1">mirakuru @ pypi</a></p></li>
<li><p><a class="reference external" href="http://mirakuru.readthedocs.org/">mirakuru @ readthedocs</a></p></li>
<li><p><a class="reference external" href="https://github.com/ClearcodeHQ/mirakuru">mirakuru @ github</a></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Edit (2014-07-06)</strong></p>
<p>As I read few months ago about releasing packages, almost every package,
library out there, has some commit named <strong>fixed MANIFEST.in</strong> or something
similar related to fixing package or distribution.</p>
<p>Mirakuru is not an exception in this regards. Although wheel was installing
just fine, I forgot to include CHANGES.rst file for package even though
included it in setup.py's <em>long_description</em> argument, which in return caused
errors when installing mirakuru from source distribution.</p>
</div>
</section>
</div>
    
        <ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-redirect-user-around-your-website/" rel="prev" title="How to redirect user around Your website?">Previous post</a>
            </li>
            <li class="next">
                <a href="../mirakuru-02-released/" rel="next" title="mirakuru 0.2 released">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="http://blog.fizyk.net.pl/blog/mirakuru-your-tests-little-helper/",
        disqus_title="mirakuru, your tests little helper",
        disqus_identifier="cache/posts/2014-07-03-mirakuru-your-tests-little-helper.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </div>

        </div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="http://blog.fizyk.net.pl/" title="Cases">Cases</a>
            </h1>
            
            <small>
                Also available in: 
                
            <li><a href="http://blog.fizyk.net.pl/pl/" rel="alternate" hreflang="pl">Polski</a></li>

            </small>
            
            <ul class="unstyled">
<li>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    <img alt="Licencja Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a>
<br>Ten utwór, autorstwa
<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
    Grzegorz Śliwiński</span>
jest dostępny na licencji
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    Creative Commons Uznanie autorstwa 3.0 Unported
</a>.</li>
            
                <li>
<a href="http://www.fizyk.net.pl/en">Homepage</a>
                </li>
<li>
<a href="../../archive/">Archives</a>
                </li>
<li>
<a href="../../tags/">Tags</a>

            </li>
<li>
            
            
            </ul>
</div>
        <div id="footer">
            Contents © 2021 <a href="mailto:fizyk~~fizyk.net.pl">Grzegorz Śliwiński</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
        </div>
    </div>
    
            <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
