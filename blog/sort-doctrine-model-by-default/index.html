<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Recently, I thought, that it would be great to sort by default tags from fzTagPlugin by weight anywhere. So I started to look, as I remembered to read a while ago about an option that can be set on relations. I finally found it but... it's not suitable for many-to-many relations, which is used for tags.">
<meta name="viewport" content="width=device-width">
<title>Sort doctrine Model by default | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="../../pl/rss.xml">
<link rel="canonical" href="https://fizyk.dev/blog/sort-doctrine-model-by-default/">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
</head>
<body class="home blog">
    <div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Sort doctrine Model by default</a></h1>

        <div class="meta" style="background-color: rgb(234, 234, 234); ">
        <span class="authordate">
            Posted: <time class="published" datetime="2011-02-16T22:02:06+01:00">16 2 2011 22:02</time>
               [<a href="index.rst" id="sourcelink">Source</a>]
        </span>
        <br><span class="tags">Tags: 
                    <a class="tag" href="../../tags/doctrine/"><span>doctrine</span></a>
                    <a class="tag" href="../../tags/fztag/"><span>fzTag</span></a>
                    <a class="tag" href="../../tags/symfony/"><span>symfony</span></a>
                </span>
                <br><span class="authordate">
            

        </span>
        </div>
    <p>Recently, I thought, that it would be great to sort by default tags from
<a class="reference external" href="http://www.symfony-project.org/plugins/fzTagPlugin">fzTagPlugin</a> by
weight anywhere. So I started to look, as I remembered to read a while
ago about an option that can be set on relations. I finally found it
but... it's not suitable for many-to-many relations, which is used for
tags.</p>
<!-- TEASER_END -->
<p>It took me two days to find that article (<a class="reference external" href="http://test.ical.ly/2010/09/30/did-you-know-that-you-can-sort-your-doctrine-relations-by-setting-an-orderby-option-in-your-schema/">Did you know
that...</a>)
again, and there, in the comments I found what I was looking for. It is
even simpler than setting orderBy for relation, you can set up orderBy
for entire model:</p>
<div class="code"><pre class="code yaml"><a id="rest_code_711713cea366496ead81b95865cb5146-1" name="rest_code_711713cea366496ead81b95865cb5146-1" href="#rest_code_711713cea366496ead81b95865cb5146-1"></a><span class="nt">fzTag</span><span class="p">:</span>
<a id="rest_code_711713cea366496ead81b95865cb5146-2" name="rest_code_711713cea366496ead81b95865cb5146-2" href="#rest_code_711713cea366496ead81b95865cb5146-2"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
<a id="rest_code_711713cea366496ead81b95865cb5146-3" name="rest_code_711713cea366496ead81b95865cb5146-3" href="#rest_code_711713cea366496ead81b95865cb5146-3"></a><span class="w">    </span><span class="nt">orderBy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weight DESC</span>
</pre></div>
<p>Now, after building up model, doctrine adds that sorting to your query
unless you set up your own orderBy settings. Everything looks and works
great, unless you actually try to retrieve tagged object and tags in one
query.</p>
<div class="code"><pre class="code php"><a id="rest_code_179d6826fabf425aba3e683d537bab49-1" name="rest_code_179d6826fabf425aba3e683d537bab49-1" href="#rest_code_179d6826fabf425aba3e683d537bab49-1"></a><span class="x">ObjectTable::getinstance() -&gt;createQuery('a')-&gt;leftJoin('a.Tags t');</span>
</pre></div>
<p>After that Doctrine tries to sort both by weight both tags and
association table.</p>
<div class="code"><pre class="code mysql"><a id="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-1" name="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-1" href="#rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">o</span>
<a id="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-2" name="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-2" href="#rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-2"></a><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">object_fz_tag</span><span class="w"> </span><span class="n">o2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<a id="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-3" name="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-3" href="#rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-3"></a><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">fz_tag</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2</span><span class="p">.</span><span class="n">tag_id</span>
<a id="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-4" name="rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-4" href="#rest_code_92b6d9b11ed64be9bb7ff1786bc4abcd-4"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">o2</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</pre></div>
<p>And even if it worked, would you dare to guess how would object's list
looked like? Well... it would probably be sorted by tag's weight, unless
you'd add your own order by. But then would have to set orderBy on tags
as well.</p>
    
        <ul class="pager hidden-print">
<li class="previous">
                <a href="../decrease-number-of-queries-for-admin-generated-module-the-better-way/" rel="prev" title="Decrease number of queries for admin generated module: the better way">Previous post</a>
            </li>
            <li class="next">
                <a href="../default-filter-values-in-admin-generated-symfony-module/" rel="next" title="Default filter values in admin-generated symfony module">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="https://fizyk.dev/blog/sort-doctrine-model-by-default/",
        disqus_title="Sort doctrine Model by default",
        disqus_identifier="cache/posts/2011-02-16-sort-doctrine-model-by-default.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </div>

        </div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="https://fizyk.dev/" title="Cases">Cases</a>
            </h1>
            
            <small>
                Also available in: 
                
            <li><a href="https://fizyk.dev/pl/" rel="alternate" hreflang="pl">Polski</a></li>

            </small>
            
            <ul class="unstyled">
<li>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    <img alt="Licencja Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a>
<br>Ten utwór, autorstwa
<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
    Grzegorz Śliwiński</span>
jest dostępny na licencji
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    Creative Commons Uznanie autorstwa 3.0 Unported
</a>.</li>
            
                <li>
<a href="https://fizyk.dev/">Homepage</a>
                </li>
<li>
<a href="../../archive/">Archives</a>
                </li>
<li>
<a href="../../tags/">Tags</a>

            </li>
<li>
            
            
            </ul>
</div>
        <div id="footer">
            Contents © 2025 <a href="mailto:fizyk~~fizyk.dev">Grzegorz Śliwiński</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
        </div>
    </div>
    
            <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
