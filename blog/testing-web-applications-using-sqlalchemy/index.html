<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Testing web applications using SQLAlchemy. | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" hreflang="pl" href="../../pl/rss.xml">
<link rel="canonical" href="http://blog.fizyk.net.pl/blog/testing-web-applications-using-sqlalchemy/">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Grzegorz Śliwiński">
<link rel="prev" href="../elasticsearch-analyzers/" title="Elasticsearch analyzers" type="text/html">
<link rel="next" href="../pyramid_fullauth-030-released/" title="pyramid_fullauth 0.3.0 released!" type="text/html">
<meta property="og:site_name" content="Cases">
<meta property="og:title" content="Testing web applications using SQLAlchemy.">
<meta property="og:url" content="http://blog.fizyk.net.pl/blog/testing-web-applications-using-sqlalchemy/">
<meta property="og:description" content="Some time ago, I decided to refactor pyramid_fullauth tests from mostly unittest style
(though run by py.test) to same factor function style tests and base them on
pytest_pyramid package,
when it come">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-04-09T23:13:57+02:00">
<meta property="article:tag" content="fullauth">
<meta property="article:tag" content="pytest-dbfixtures">
<meta property="article:tag" content="python">
<meta property="article:tag" content="sqlalchemy">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">Cases</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item"><a href="../../pl/" rel="alternate" hreflang="pl" class="nav-link">Polski</a></li>

                    
                    
    
    <li class="nav-item">
    <a href="index.rst" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="http://www.fizyk.net.pl/en" class="nav-link">Homepage</a>
                </li>
<li class="nav-item">
<a href="../../archive/" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../tags/" class="nav-link">Tags</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Testing web applications using SQLAlchemy.</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Grzegorz Śliwiński
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2014-04-09T23:13:57+02:00" itemprop="datePublished" title="09 4 2014 23:13">09 4 2014 23:13</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2014-04-09-testing-web-applications-using-sqlalchemy.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Some time ago, I decided to refactor <a class="reference external" href="https://pypi.python.org/pypi/pyramid_fullauth">pyramid_fullauth</a> tests from mostly unittest style
(though run by py.test) to same factor function style tests and base them on
<a class="reference external" href="https://pypi.python.org/pypi/pytest_pyramid">pytest_pyramid</a> package,
when it comes to test webapp. Everhything went smoothly,
until I stumbled upon <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a> session in tests.</p>
<!-- TEASER_END -->
<p>First problem was to control sqlalchemy's session in web application,
which was different than in test fixtures. Somehow the data entered into one
session, wasn't visible in another within the same process (used by application).
That's something I haven't figured out why, and would be grateful
for any explanation, however I managed to get around it. I've just made sure,
that both in test and within application, the same session is being used.</p>
<p>I made sure that the connection is being set up by me in fixture, and then assigned it to the pyramid_basemodel's global Session attribute. To make sure, I'm not using local copy anywhere in the pyramid_fullauth, I treat the Session as pyramid_basemodel's attribute, by calling it always through full namespace.</p>
<pre class="code python"><a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-1" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-1"></a><span class="kn">import</span> <span class="nn">pyramid_basemodel</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-2" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-2"></a>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-3" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-3"></a><span class="c1"># ...</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-4" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-4"></a>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-5" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-5"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">'function'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">'sqlite'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">,</span> <span class="s1">'postgresql'</span><span class="p">])</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-6" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-6"></a><span class="k">def</span> <span class="nf">db_session</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-7" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-7"></a>    <span class="sd">"""SQLAlchemy session."""</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-8" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-8"></a>    <span class="kn">from</span> <span class="nn">pyramid_fullauth.models</span> <span class="kn">import</span> <span class="n">Base</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-9" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-9"></a>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-10" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-10"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'sqlite'</span><span class="p">:</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-11" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-11"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'sqlite:///fullauth.sqlite'</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-12" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-12"></a>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-13" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-13"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-14" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-14"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-15" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-15"></a>        <span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
<a id="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-16" name="rest_code_3bd1d48d85d74f9f9742bc39ccf8e747-16"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">bind_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">should_drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre>
<p>That's it! Of course, I have to remember to use <strong>transaction.commit()</strong>,
not <strong>Session.commit()</strong>, and that by default ZopeTransactionExtension closes
connection after commit, so all instances need to be merged back into session.
Very misleading that one, when working with code, that does not modify session's
behaviour that much, like flask-sqlalchemy.</p>
<p>The other problem, was closing connection, which suddenly became an issue when
testing with postgresql.
I employed <a class="reference external" href="https://pypi.python.org/pypi/pytest-dbfixtures">pytest-dbfixtures</a>
for starting database processes as needed in tests. dbfixtures povides both
process fixtures and client fixtures.</p>
<p>Process is session scoped, while client, is function scoped, and creates database
at the beginning of a test, and drops it right after. Using sqlalchemy session
underneath, I created physically two connections to that database. And surprisingly,
when client fixture tries to drop databse, the SQLALchemy's connection still lives!
It didn't disturb mysqldb, but did disturb postgresql, which couldn't drop database.
When you think about it, mysql behaves rather strange here, although more convenient.
So the question was, how to close SQLALchemy's connection?</p>
<p>Answer came in this <a class="reference external" href="http://stackoverflow.com/questions/7186961/how-do-i-close-the-engine-created-by-sqlalchemy-ext-sqlsoup">stackoverflow thread</a>, <strong>engine.dispose()</strong>! However it's
<a class="reference external" href="http://stackoverflow.com/questions/21738944/how-can-i-properly-close-a-sqlalchemy-session">follow-up</a> had cleaner solution, to use <strong>NullPool</strong> instead! This, when closing session, instead moving connection back to pool, just closes it, as there's no connection pool!</p>
<p>So, after this, the whole sqlalchemy session fixture looks like that:</p>
<pre class="code python"><a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-1" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">'function'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">'sqlite'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">,</span> <span class="s1">'postgresql'</span><span class="p">])</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-2" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-2"></a><span class="k">def</span> <span class="nf">db_session</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-3" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-3"></a>    <span class="sd">"""SQLAlchemy session."""</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-4" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-4"></a>    <span class="kn">from</span> <span class="nn">pyramid_fullauth.models</span> <span class="kn">import</span> <span class="n">Base</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-5" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-5"></a>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-6" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-6"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'sqlite'</span><span class="p">:</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-7" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-7"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'sqlite:///fullauth.sqlite'</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-8" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-8"></a>    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'mysql'</span><span class="p">:</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-9" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-9"></a>        <span class="n">request</span><span class="o">.</span><span class="n">getfuncargvalue</span><span class="p">(</span><span class="s1">'mysqldb'</span><span class="p">)</span>  <span class="c1"># takes care of creating database</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-10" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-10"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'mysql+mysqldb://root:@127.0.0.1:3307/tests?charset=utf8'</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-11" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-11"></a>    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'postgresql'</span><span class="p">:</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-12" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-12"></a>        <span class="n">request</span><span class="o">.</span><span class="n">getfuncargvalue</span><span class="p">(</span><span class="s1">'postgresql'</span><span class="p">)</span>  <span class="c1"># takes care of creating database</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-13" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-13"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'postgresql+psycopg2://postgres:@127.0.0.1:5433/tests'</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-14" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-14"></a>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-15" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-15"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">NullPool</span><span class="p">)</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-16" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-16"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-17" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-17"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">bind_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">should_drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-18" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-18"></a>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-19" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-19"></a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">():</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-20" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-20"></a>        <span class="n">transaction</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-21" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-21"></a>        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-22" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-22"></a>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-23" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-23"></a>    <span class="n">request</span><span class="o">.</span><span class="n">addfinalizer</span><span class="p">(</span><span class="n">destroy</span><span class="p">)</span>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-24" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-24"></a>
<a id="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-25" name="rest_code_0d7b84d044364a2fb5aca6ec72b594e8-25"></a>    <span class="k">return</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span>
</pre>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/fullauth/" rel="tag">fullauth</a></li>
            <li><a class="tag p-category" href="../../tags/pytest-dbfixtures/" rel="tag">pytest-dbfixtures</a></li>
            <li><a class="tag p-category" href="../../tags/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../tags/sqlalchemy/" rel="tag">sqlalchemy</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../elasticsearch-analyzers/" rel="prev" title="Elasticsearch analyzers">Previous post</a>
            </li>
            <li class="next">
                <a href="../pyramid_fullauth-030-released/" rel="next" title="pyramid_fullauth 0.3.0 released!">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="http://blog.fizyk.net.pl/blog/testing-web-applications-using-sqlalchemy/",
        disqus_title="Testing web applications using SQLAlchemy.",
        disqus_identifier="cache/posts/2014-04-09-testing-web-applications-using-sqlalchemy.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="casesblog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2021 <a href="mailto:fizyk~~fizyk.net.pl">Grzegorz Śliwiński</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
