<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Testing web applications using SQLAlchemy. | Cases</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" href="../../pl/rss.xml">
<link rel="canonical" href="https://fizyk.dev/blog/testing-web-applications-using-sqlalchemy/">
<link rel="icon" href="../../favicon-speddial.png" sizes="269x262">
<link rel="icon" href="../../favicon.png" sizes="62x60">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
</head>
<body class="home blog">
    <div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Testing web applications using SQLAlchemy.</a></h1>

        <div class="meta" style="background-color: rgb(234, 234, 234); ">
        <span class="authordate">
            Posted: <time class="published" datetime="2014-04-09T23:13:57+02:00">09 4 2014 23:13</time>
               [<a href="index.rst" id="sourcelink">Source</a>]
        </span>
        <br><span class="tags">Tags:Â 
                    <a class="tag" href="../../tags/fullauth/"><span>fullauth</span></a>
                    <a class="tag" href="../../tags/pytest-dbfixtures/"><span>pytest-dbfixtures</span></a>
                    <a class="tag" href="../../tags/python/"><span>python</span></a>
                    <a class="tag" href="../../tags/sqlalchemy/"><span>sqlalchemy</span></a>
                </span>
                <br><span class="authordate">
            

        </span>
        </div>
    <p>Some time ago, I decided to refactor <a class="reference external" href="https://pypi.python.org/pypi/pyramid_fullauth">pyramid_fullauth</a> tests from mostly unittest style
(though run by py.test) to same factor function style tests and base them on
<a class="reference external" href="https://pypi.python.org/pypi/pytest_pyramid">pytest_pyramid</a> package,
when it comes to test webapp. Everhything went smoothly,
until I stumbled upon <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a> session in tests.</p>
<!-- TEASER_END -->
<p>First problem was to control sqlalchemy's session in web application,
which was different than in test fixtures. Somehow the data entered into one
session, wasn't visible in another within the same process (used by application).
That's something I haven't figured out why, and would be grateful
for any explanation, however I managed to get around it. I've just made sure,
that both in test and within application, the same session is being used.</p>
<p>I made sure that the connection is being set up by me in fixture, and then assigned it to the pyramid_basemodel's global Session attribute. To make sure, I'm not using local copy anywhere in the pyramid_fullauth, I treat the Session as pyramid_basemodel's attribute, by calling it always through full namespace.</p>
<div class="code"><pre class="code python"><a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-1" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-1" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pyramid_basemodel</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-2" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-2" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-2"></a>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-3" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-3" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-3"></a><span class="c1"># ...</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-4" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-4" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-4"></a>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-5" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-5" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-5"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">'function'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">'sqlite'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">,</span> <span class="s1">'postgresql'</span><span class="p">])</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-6" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-6" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">db_session</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-7" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-7" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-7"></a><span class="w">    </span><span class="sd">"""SQLAlchemy session."""</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-8" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-8" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-8"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">pyramid_fullauth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-9" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-9" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-9"></a>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-10" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-10" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-10"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'sqlite'</span><span class="p">:</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-11" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-11" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-11"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'sqlite:///fullauth.sqlite'</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-12" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-12" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-12"></a>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-13" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-13" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-13"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-14" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-14" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-14"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-15" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-15" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-15"></a>        <span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
<a id="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-16" name="rest_code_476e9e1f4fd54a549cf5bf195f177fe7-16" href="#rest_code_476e9e1f4fd54a549cf5bf195f177fe7-16"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">bind_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">should_drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<p>That's it! Of course, I have to remember to use <strong>transaction.commit()</strong>,
not <strong>Session.commit()</strong>, and that by default ZopeTransactionExtension closes
connection after commit, so all instances need to be merged back into session.
Very misleading that one, when working with code, that does not modify session's
behaviour that much, like flask-sqlalchemy.</p>
<p>The other problem, was closing connection, which suddenly became an issue when
testing with postgresql.
I employed <a class="reference external" href="https://pypi.python.org/pypi/pytest-dbfixtures">pytest-dbfixtures</a>
for starting database processes as needed in tests. dbfixtures povides both
process fixtures and client fixtures.</p>
<p>Process is session scoped, while client, is function scoped, and creates database
at the beginning of a test, and drops it right after. Using sqlalchemy session
underneath, I created physically two connections to that database. And surprisingly,
when client fixture tries to drop databse, the SQLALchemy's connection still lives!
It didn't disturb mysqldb, but did disturb postgresql, which couldn't drop database.
When you think about it, mysql behaves rather strange here, although more convenient.
So the question was, how to close SQLALchemy's connection?</p>
<p>Answer came in this <a class="reference external" href="http://stackoverflow.com/questions/7186961/how-do-i-close-the-engine-created-by-sqlalchemy-ext-sqlsoup">stackoverflow thread</a>, <strong>engine.dispose()</strong>! However it's
<a class="reference external" href="http://stackoverflow.com/questions/21738944/how-can-i-properly-close-a-sqlalchemy-session">follow-up</a> had cleaner solution, to use <strong>NullPool</strong> instead! This, when closing session, instead moving connection back to pool, just closes it, as there's no connection pool!</p>
<p>So, after this, the whole sqlalchemy session fixture looks like that:</p>
<div class="code"><pre class="code python"><a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-1" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-1" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">'function'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">'sqlite'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">,</span> <span class="s1">'postgresql'</span><span class="p">])</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-2" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-2" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">db_session</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-3" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-3" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-3"></a><span class="w">    </span><span class="sd">"""SQLAlchemy session."""</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-4" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-4" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-4"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">pyramid_fullauth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Base</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-5" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-5" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-5"></a>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-6" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-6" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-6"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'sqlite'</span><span class="p">:</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-7" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-7" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-7"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'sqlite:///fullauth.sqlite'</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-8" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-8" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-8"></a>    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'mysql'</span><span class="p">:</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-9" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-9" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-9"></a>        <span class="n">request</span><span class="o">.</span><span class="n">getfuncargvalue</span><span class="p">(</span><span class="s1">'mysqldb'</span><span class="p">)</span>  <span class="c1"># takes care of creating database</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-10" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-10" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-10"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'mysql+mysqldb://root:@127.0.0.1:3307/tests?charset=utf8'</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-11" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-11" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-11"></a>    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="s1">'postgresql'</span><span class="p">:</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-12" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-12" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-12"></a>        <span class="n">request</span><span class="o">.</span><span class="n">getfuncargvalue</span><span class="p">(</span><span class="s1">'postgresql'</span><span class="p">)</span>  <span class="c1"># takes care of creating database</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-13" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-13" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-13"></a>        <span class="n">connection</span> <span class="o">=</span> <span class="s1">'postgresql+psycopg2://postgres:@127.0.0.1:5433/tests'</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-14" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-14" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-14"></a>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-15" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-15" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-15"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">NullPool</span><span class="p">)</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-16" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-16" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-16"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-17" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-17" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-17"></a>    <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">bind_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">should_drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-18" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-18" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-18"></a>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-19" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-19" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-19"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">destroy</span><span class="p">():</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-20" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-20" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-20"></a>        <span class="n">transaction</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-21" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-21" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-21"></a>        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-22" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-22" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-22"></a>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-23" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-23" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-23"></a>    <span class="n">request</span><span class="o">.</span><span class="n">addfinalizer</span><span class="p">(</span><span class="n">destroy</span><span class="p">)</span>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-24" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-24" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-24"></a>
<a id="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-25" name="rest_code_36a4f838c3114e23aaf02f2f6b117dd4-25" href="#rest_code_36a4f838c3114e23aaf02f2f6b117dd4-25"></a>    <span class="k">return</span> <span class="n">pyramid_basemodel</span><span class="o">.</span><span class="n">Session</span>
</pre></div>
    
        <ul class="pager hidden-print">
<li class="previous">
                <a href="../elasticsearch-analyzers/" rel="prev" title="Elasticsearch analyzers">Previous post</a>
            </li>
            <li class="next">
                <a href="../pyramid_fullauth-030-released/" rel="next" title="pyramid_fullauth 0.3.0 released!">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="casesblog",
            disqus_url="https://fizyk.dev/blog/testing-web-applications-using-sqlalchemy/",
        disqus_title="Testing web applications using SQLAlchemy.",
        disqus_identifier="cache/posts/2014-04-09-testing-web-applications-using-sqlalchemy.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </div>

        </div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="https://fizyk.dev/" title="Cases">Cases</a>
            </h1>
            
            <small>
                Also available in:Â 
                
            <li><a href="https://fizyk.dev/pl/" rel="alternate" hreflang="pl">Polski</a></li>

            </small>
            
            <ul class="unstyled">
<li>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    <img alt="Licencja Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a>
<br>Ten utwÃ³r, autorstwa
<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
    Grzegorz ÅliwiÅski</span>
jest dostÄpny na licencji
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.pl">
    Creative Commons Uznanie autorstwa 3.0 Unported
</a>.</li>
            
                <li>
<a href="https://fizyk.dev/en">Homepage</a>
                </li>
<li>
<a href="../../archive/">Archives</a>
                </li>
<li>
<a href="../../tags/">Tags</a>

            </li>
<li>
            
            
            </ul>
</div>
        <div id="footer">
            Contents Â© 2025 <a href="mailto:fizyk~~fizyk.dev">Grzegorz ÅliwiÅski</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
            
        </div>
    </div>
    
            <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20536007-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
